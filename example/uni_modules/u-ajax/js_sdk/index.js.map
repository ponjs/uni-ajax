{"version":3,"file":"index.js","sources":["../../../../src/lib/interceptor.js","../../../../src/lib/utils.js","../../../../src/lib/defaults.js","../../../../src/lib/helpers.js","../../../../src/lib/handler.js","../../../../src/lib/ajax.js","../../../../src/index.js"],"sourcesContent":["export default class Interceptor {\r\n  constructor() {\r\n    this.fulfilled = res => res\r\n    this.rejected = err => err\r\n  }\r\n  /**\r\n   * 拦截器\r\n   * @param {function} fulfilled 拦截成功\r\n   * @param {function} rejected 拦截失败\r\n   */\r\n  use(fulfilled, rejected) {\r\n    typeof fulfilled === 'function' && (this.fulfilled = fulfilled)\r\n    typeof rejected === 'function' && (this.rejected = rejected)\r\n  }\r\n}\r\n","/**\r\n * 获取值的原始类型字符串，例如 [object Object]\r\n */\r\nconst _toString = Object.prototype.toString\r\n\r\n/**\r\n * 判断是否为数组\r\n * @param {*} val 要判断的值\r\n * @returns {boolean} 返回判断结果\r\n */\r\nexport function isArray(val) {\r\n  return _toString.call(val) === '[object Array]'\r\n}\r\n\r\n/**\r\n * 判断是否为普通对象\r\n * @param {*} val 要判断的值\r\n * @returns {boolean} 返回判断结果\r\n */\r\nexport function isObject(val) {\r\n  return _toString.call(val) === '[object Object]'\r\n}\r\n\r\n/**\r\n * 遍历\r\n * @param {object|array} obj 要迭代的对象\r\n * @param {function} fn 为每个项调用的回调\r\n */\r\nexport function forEach(obj, fn) {\r\n  if (obj === null || obj === undefined) return\r\n  if (typeof obj !== 'object') obj = [obj]\r\n  if (isArray(obj)) {\r\n    for (let i = 0, l = obj.length; i < l; i++) {\r\n      fn.call(null, obj[i], i, obj)\r\n    }\r\n  } else {\r\n    for (const k in obj) {\r\n      if (Object.prototype.hasOwnProperty.call(obj, k)) {\r\n        fn.call(null, obj[k], k, obj)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 对象深合并\r\n * @param  {...object} args 对象\r\n * @returns {object} 合并后的对象\r\n */\r\nexport function merge(...args) {\r\n  let result = {}\r\n  for (let i = 0, l = args.length; i < l; i++) {\r\n    isObject(args[i]) && forEach(args[i], (val, key) => (result[key] = assign(result[key], val)))\r\n  }\r\n  return result\r\n}\r\n\r\n/**\r\n * 合并分配到目标对象\r\n * @param {*} target 目标对象\r\n * @param {*} source 源对象\r\n * @returns {*} 目标对象\r\n */\r\nexport function assign(target, source) {\r\n  if (isObject(target) && isObject(source)) {\r\n    return merge(target, source)\r\n  } else if (isObject(source)) {\r\n    return merge({}, source)\r\n  } else if (isArray(source)) {\r\n    return source.slice()\r\n  }\r\n  return source\r\n}\r\n","import { forEach } from './utils'\r\n\r\nexport const METHOD = ['get', 'post', 'put', 'delete', 'connect', 'head', 'options', 'trace']\r\nexport const HEADER = ['common', ...METHOD]\r\n\r\nvar defaults = {\r\n  header: {},\r\n  method: 'GET',\r\n  timeout: 30000,\r\n  dataType: 'json',\r\n  responseType: 'text',\r\n  sslVerify: true,\r\n  withCredentials: false,\r\n  firstIpv4: false,\r\n  validateStatus: statusCode => statusCode >= 200 && statusCode < 300\r\n}\r\n\r\nforEach(HEADER, h => (defaults.header[h] = {}))\r\n\r\nexport default defaults\r\n","import { assign, forEach } from './utils'\r\n\r\n/**\r\n * 分离请求对象\r\n * @param {string|object} [url] 请求地址 / 请求配置\r\n * @param {string|object} [data] 请求参数\r\n * @param {object} [config] 请求配置\r\n * @returns {object} 回调函数对象 去除回调的请求参数\r\n */\r\nexport function detachConfig(url, data, config) {\r\n  // 回调函数对象\r\n  let callback = {}\r\n  // 去除回调的请求参数对象\r\n  let params = {}\r\n\r\n  // 请求参数对象\r\n  const value = typeof url === 'string' ? { ...config, url, data } : url\r\n\r\n  // 分离请求参数\r\n  forEach(value, (val, key) => {\r\n    if (isCallback(key)) callback[key] = val\r\n    else params[key] = val\r\n  })\r\n\r\n  return { callback, params }\r\n}\r\n\r\n/**\r\n * 合并请求配置（深度合并，且不合并 undefined 值）\r\n * @param {object} config1 前请求配置\r\n * @param {object} [config2] 后请求配置\r\n * @returns {object} 合并后的请求配置\r\n */\r\nexport function mergeConfig(config1, config2 = {}) {\r\n  let config = {}\r\n\r\n  const configKeys = Object.keys({ ...config1, ...config2 })\r\n\r\n  forEach(configKeys, prop => {\r\n    if (config2[prop] !== undefined) {\r\n      config[prop] = assign(config1[prop], config2[prop])\r\n    } else if (config1[prop] !== undefined) {\r\n      config[prop] = assign(undefined, config1[prop])\r\n    }\r\n  })\r\n\r\n  return config\r\n}\r\n\r\n/**\r\n * 判断参数是否含有回调参数 success / fail / complete 之一\r\n * @param {string} field 参数的 Key 值字符串\r\n * @returns {boolean} 返回判断值\r\n */\r\nexport function isCallback(field) {\r\n  return ['success', 'fail', 'complete'].includes(field)\r\n}\r\n\r\n/**\r\n * 根据 baseURL 和 url 拼接\r\n * @param {string} baseURL 请求跟地址\r\n * @param {string} relativeURL 请求参数地址\r\n * @returns {string} 拼接后的地址\r\n */\r\nexport function combineURL(baseURL = '', relativeURL = '') {\r\n  // 判断是否 http:// 或 https:// 开头\r\n  if (/^https?:\\/\\//.test(relativeURL)) return relativeURL\r\n  // 去除 baseURL 结尾斜杠，去除 relativeURL 开头斜杠，再判断拼接\r\n  return relativeURL ? baseURL.replace(/\\/+$/, '') + '/' + relativeURL.replace(/^\\/+/, '') : baseURL\r\n}\r\n\r\n/**\r\n * 根据 baseURL 获取源地址\r\n * @param {string} baseURL 请求跟地址\r\n * @returns {string} 源地址\r\n */\r\nexport function originURL(baseURL = '') {\r\n  // 判断是否 http:// 或 https:// 开头\r\n  if (!/^https?:\\/\\//.test(baseURL)) return ''\r\n  const u = baseURL.split('/')\r\n  return u[0] + '//' + u[2]\r\n}\r\n","import { HEADER } from './defaults'\r\nimport { combineURL, mergeConfig, isCallback } from './helpers'\r\nimport { forEach, isObject, merge } from './utils'\r\n\r\n/**\r\n * 处理请求前\r\n * @param {object} request 请求参数\r\n * @returns {object} 处理后的请求参数对象\r\n */\r\nexport async function handleRequest(request) {\r\n  let params = mergeConfig(this.config, request)\r\n\r\n  // 这里转大写是方便拦截器的相应操作\r\n  params.method = params.method.toUpperCase()\r\n\r\n  // 拦截后的请求参数\r\n  let config = await this.request.interceptors.request.fulfilled(params)\r\n\r\n  // 判断请求拦截返回是否为对象\r\n  if (!isObject(config)) {\r\n    const error = await this.request.interceptors.request.rejected({\r\n      config,\r\n      errMsg: 'request:fail parameter'\r\n    })\r\n    return Promise.reject(error)\r\n  }\r\n\r\n  // 拼接 url\r\n  config.url = combineURL(config.baseURL, config.url)\r\n\r\n  // 请求方法转大写\r\n  config.method = config.method.toUpperCase()\r\n\r\n  // 调整 header 优先级\r\n  config.header = merge(\r\n    config.header.common,\r\n    config.header[config.method.toLowerCase()],\r\n    config.header\r\n  )\r\n\r\n  // 清除多余的请求头\r\n  forEach(HEADER, h => isObject(config.header[h]) && delete config.header[h])\r\n\r\n  // 清除回调函数\r\n  forEach(config, (fn, key) => isCallback(key) && delete config[key])\r\n\r\n  return config\r\n}\r\n\r\n/**\r\n * 处理响应后\r\n * @param {Object} response 处理响应参数\r\n * @param {object} response.config 请求配置\r\n * @param {object} response.callback 回调函数对象\r\n * @param {function} response.resolve Promise 的 resolve 方法\r\n * @param {function} response.reject Promise 的 reject 方法\r\n * @returns {function} 处理后的 complete 方法\r\n */\r\nexport function handleResponse({ config, callback, ...promise }) {\r\n  return async res => {\r\n    try {\r\n      // 根据状态码判断要执行的回调和拦截器\r\n      const state =\r\n        !config.validateStatus || config.validateStatus(res.statusCode) ? 'fulfilled' : 'rejected'\r\n      var result = await this.request.interceptors.response[state]({ config, ...res })\r\n      var field = state === 'fulfilled' ? 'success' : 'fail'\r\n    } catch (error) {\r\n      // 拦截器返回错误\r\n      result = error\r\n      field = 'fail'\r\n    }\r\n\r\n    // 请求参数没有回调函数\r\n    if (!Object.keys(callback).length) {\r\n      return promise[field === 'success' ? 'resolve' : 'reject'](result)\r\n    }\r\n\r\n    // 执行回调函数\r\n    callback[field]?.(result)\r\n    callback.complete?.(result)\r\n  }\r\n}\r\n","import Interceptor from './interceptor'\r\nimport defaults, { METHOD } from './defaults'\r\nimport { detachConfig, mergeConfig, originURL } from './helpers'\r\nimport { forEach } from './utils'\r\nimport { handleRequest, handleResponse } from './handler'\r\n\r\nexport default class Ajax {\r\n  constructor(config) {\r\n    // 合并请求配置赋值到实例配置\r\n    this.config = mergeConfig(defaults, config)\r\n\r\n    // 挂载拦截器\r\n    this.request.interceptors = { request: new Interceptor(), response: new Interceptor() }\r\n\r\n    // 挂载接口根地址 baseURL\r\n    this.request.baseURL = this.config.baseURL || ''\r\n\r\n    // 挂载接口根地址的源地址 origin\r\n    this.request.origin = originURL(this.config.baseURL)\r\n\r\n    // 挂载修改 config 方法\r\n    this.request.config = fn => (this.config = fn(this.config))\r\n\r\n    // 挂载对应的 method 方法\r\n    forEach(METHOD, method => {\r\n      this.request[method] = (url, data, config) =>\r\n        this.request(\r\n          ...(typeof url === 'string' ? [url, data, { ...config, method }] : [{ ...url, method }])\r\n        )\r\n    })\r\n  }\r\n  request = (...args) => {\r\n    // 分类请求参数\r\n    const { callback, params } = detachConfig(...args)\r\n    // 回调函数字段\r\n    const fields = Object.keys(callback)\r\n    // 定义 RequestTask 所需字段\r\n    let requestTask, aborted, onHeadRcvd, offHeadRcvd\r\n\r\n    // 继承 Promise 封装 RequestTask 的一些方法\r\n    class Request extends Promise {\r\n      // 中断请求任务\r\n      abort() {\r\n        aborted = true\r\n        requestTask?.abort()\r\n        return this\r\n      }\r\n      // 监听 HTTP Response Header 事件\r\n      onHeadersReceived(fn) {\r\n        onHeadRcvd = fn\r\n        requestTask?.onHeadersReceived?.(fn)\r\n        return this\r\n      }\r\n      // 取消监听 HTTP Response Header 事件\r\n      offHeadersReceived(fn) {\r\n        offHeadRcvd = fn\r\n        requestTask?.offHeadersReceived?.(fn)\r\n        return this\r\n      }\r\n    }\r\n\r\n    return new Request(async (resolve, reject) => {\r\n      // 统一处理请求错误\r\n      try {\r\n        // 请求拦截后的配置\r\n        var config = await handleRequest.call(this, params)\r\n      } catch (error) {\r\n        // 如果有回调参数 执行 fail / complete\r\n        callback.fail?.(error)\r\n        callback.complete?.(error)\r\n        // 没有回调参数时抛出请求错误\r\n        return !fields.length && reject(error)\r\n      }\r\n\r\n      // 接口调用结束的回调函数\r\n      const complete = handleResponse.call(this, { config, callback, resolve, reject })\r\n\r\n      // 判断是否被取消请求\r\n      if (aborted) return complete({ errMsg: 'request:fail abort' })\r\n\r\n      // 发起请求\r\n      requestTask = uni.request({ ...config, complete })\r\n\r\n      // 根据配置的 xhr 属性执行获取 requestTask\r\n      typeof config.xhr === 'function' && config.xhr(requestTask, config)\r\n\r\n      // 当传入 success / fail / complete 之一时，返回 requestTask 对象\r\n      fields.length && resolve(requestTask)\r\n\r\n      // 判断是否执行监听 HTTP Response Header 事件\r\n      onHeadRcvd && requestTask.onHeadersReceived?.(onHeadRcvd)\r\n      offHeadRcvd && requestTask.offHeadersReceived?.(offHeadRcvd)\r\n    })\r\n  }\r\n}\r\n","import Ajax from './lib/ajax'\r\n\r\nfunction createInstance(defaultConfig) {\r\n  return new Ajax(defaultConfig).request\r\n}\r\n\r\nconst ajax = createInstance()\r\n\r\najax.create = function create(instanceConfig) {\r\n  return createInstance(instanceConfig)\r\n}\r\n\r\nexport default ajax\r\n"],"names":["Interceptor","constructor","fulfilled","res","rejected","err","use","_toString","Object","prototype","toString","isArray","val","call","isObject","forEach","obj","fn","undefined","i","l","length","k","hasOwnProperty","merge","args","result","key","assign","target","source","slice","METHOD","HEADER","defaults","header","method","timeout","dataType","responseType","sslVerify","withCredentials","firstIpv4","validateStatus","statusCode","h","detachConfig","url","data","config","callback","params","value","isCallback","mergeConfig","config1","config2","configKeys","keys","prop","field","includes","combineURL","baseURL","relativeURL","test","replace","originURL","u","split","handleRequest","request","toUpperCase","interceptors","error","errMsg","Promise","reject","common","toLowerCase","handleResponse","promise","state","response","complete","Ajax","fields","requestTask","aborted","onHeadRcvd","offHeadRcvd","Request","abort","onHeadersReceived","offHeadersReceived","resolve","fail","uni","xhr","origin","createInstance","defaultConfig","ajax","create","instanceConfig"],"mappings":"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"}